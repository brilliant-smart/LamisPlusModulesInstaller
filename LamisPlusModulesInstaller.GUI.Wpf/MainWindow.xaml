<Window x:Class="LamisPlusModulesInstaller.GUI.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="LamisPlus Module Installer"
        Height="600" Width="1000"
        MinHeight="500" MinWidth="800">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Authentication -->
            <RowDefinition Height="Auto"/>
            <!-- Folder selector -->
            <RowDefinition Height="*"/>
            <!-- DataGrid fills remaining space -->
            <RowDefinition Height="Auto"/>
            <!-- Progress bar + buttons -->
            <RowDefinition Height="200"/>
            <!-- Logs -->
        </Grid.RowDefinitions>

        <!-- 🔑 Authentication Section -->
        <GroupBox Grid.Row="0" Header="LAMISPlus Server Authentication" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <!-- URL Row -->
                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Server URL:" Width="100" VerticalAlignment="Center"/>
                    <TextBox Width="250" Text="{Binding BaseUrl, UpdateSourceTrigger=PropertyChanged}" Margin="5,0" />
                    <Border Width="120" Height="30" CornerRadius="5" VerticalAlignment="Center"
                            Background="{Binding IsAuthenticated, Converter={StaticResource BoolToBrushConverter}}">
                        <TextBlock Text="{Binding AuthStatus}" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center" 
                                   FontWeight="Bold" Foreground="White" />
                    </Border>
                </StackPanel>

                <!-- Username Row -->
                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Username:" Width="100" VerticalAlignment="Center"/>
                    <TextBox Width="250" Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" Margin="5,0" />
                </StackPanel>

                <!-- Password Row -->
                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Password:" Width="100" VerticalAlignment="Center"/>
                    <PasswordBox x:Name="PasswordBox" Width="250" Margin="5,0" />
                </StackPanel>

                <!-- Login Button -->
                <Button Content="🔐 Login"
                        Width="120" Margin="0,10,0,0" HorizontalAlignment="Left"
                        Command="{Binding LoginCommand}"
                        CommandParameter="{Binding ElementName=PasswordBox}" />
            </StackPanel>
        </GroupBox>

        <!-- 📂 Modules Folder Selector -->
        <GroupBox Grid.Row="1" Header="Use this section if you want to change the default modules folder" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <TextBox Width="400" 
                         Text="{Binding ModulesFolder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         IsReadOnly="True" Margin="0,0,10,0" />
                <Button Content="📂 Select Modules Folder" Width="150"
                        Command="{Binding BrowseModulesFolderCommand}"
                        IsEnabled="{Binding IsAuthenticated}" />
            </StackPanel>
        </GroupBox>

        <!-- 📋 Module Grid -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Modules}" AutoGenerateColumns="False" 
                  IsReadOnly="True" Margin="0,0,0,10">
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Status}" Value="SUCCESS">
                            <Setter Property="Background" Value="LightGreen"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Failed">
                            <Setter Property="Background" Value="Salmon"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="ERROR">
                            <Setter Property="Background" Value="Salmon"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Pending">
                            <Setter Property="Background" Value="Khaki"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Status}" Value="Installing">
                            <Setter Property="Background" Value="LightSkyBlue"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>

            <DataGrid.Columns>
                <DataGridCheckBoxColumn Header="Select" Binding="{Binding IsSelected}" Width="50"/>
                <DataGridTextColumn Header="Module Name" Binding="{Binding Name}" Width="200"/>
                <DataGridTextColumn Header="Local Version" Binding="{Binding LocalVersion}" Width="120"/>
                <DataGridTextColumn Header="Installed Version" Binding="{Binding InstalledVersion}" Width="120"/>
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="200"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- 📊 Progress + Buttons -->
        <StackPanel Grid.Row="3" Orientation="Vertical" Margin="0,0,0,10">
            <TextBlock Text="{Binding ProgressText}" HorizontalAlignment="Center" FontWeight="Bold" Margin="0,0,0,5"/>
            <ProgressBar Height="20" Minimum="0" Maximum="100"
                         Value="{Binding InstallProgress}"
                         Visibility="{Binding IsInstalling, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                <Button Content="Install All" Width="120" Margin="5" 
                        Command="{Binding InstallAllCommand}"
                        IsEnabled="{Binding IsAuthenticated}" />
                <Button Content="Install Selected" Width="120" Margin="5" 
                        Command="{Binding InstallSelectedCommand}"
                        IsEnabled="{Binding IsAuthenticated}" />
                <Button Content="Retry Failed" Width="120" Margin="5" 
                        Command="{Binding RetryFailedCommand}"
                        IsEnabled="{Binding IsAuthenticated}" />
                <Button Content="Clear Logs" Width="120" Margin="5"
                        Command="{Binding ClearLogsCommand}" />
            </StackPanel>
        </StackPanel>

        <!-- 📜 Logs -->
        <TextBox Grid.Row="4" x:Name="LogsTextBox" 
                 Text="{Binding Logs}" 
                 IsReadOnly="True" 
                 VerticalScrollBarVisibility="Auto" 
                 TextWrapping="Wrap" 
                 Background="#FFFDF8E1" />
    </Grid>
</Window>
